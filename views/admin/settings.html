<div class="max-w-4xl mx-auto space-y-6">
    
    <!-- 提示消息 -->
    {{ if .Msg }}
    <div class="bg-green-50 text-green-700 px-4 py-3 rounded-lg border border-green-200 text-sm">
        ✅ {{ .Msg }}
    </div>
    {{ end }}
    {{ if .Err }}
    <div class="bg-red-50 text-red-700 px-4 py-3 rounded-lg border border-red-200 text-sm">
        ❌ {{ .Err }}
    </div>
    {{ end }}

    <form action="/admin/settings" method="POST" class="space-y-6">
        
        <!-- 1. 站点设置卡片 -->
        <div class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden">
            <div class="p-6 border-b border-gray-100 bg-gray-50/50">
                <h2 class="text-lg font-bold text-gray-900">基本设置</h2>
                <p class="text-xs text-gray-500 mt-1">SEO 与 站点元数据</p>
            </div>
            
            <div class="p-6 space-y-5">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-1">网站标题</label>
                        <input type="text" name="site_title" value="{{.Site.site_title}}" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-black focus:border-black outline-none transition sm:text-sm">
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-1">Base URL</label>
                        <input type="text" name="site_url" value="{{.Site.site_url}}" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-black outline-none transition sm:text-sm" placeholder="http://example.com">
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1">SEO 关键词</label>
                    <input type="text" name="site_keywords" value="{{.Site.site_keywords}}" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-black outline-none transition sm:text-sm" placeholder="blog, tech, life">
                </div>

                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1">网站描述</label>
                    <textarea name="site_description" rows="3" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-black outline-none transition sm:text-sm">{{.Site.site_description}}</textarea>
                </div>
            </div>
        </div>

        <!-- 2. 安全设置卡片 -->
        <div class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden">
            <div class="p-6 border-b border-gray-100 bg-gray-50/50">
                <h2 class="text-lg font-bold text-gray-900">安全设置</h2>
                <p class="text-xs text-gray-500 mt-1">修改管理员密码 (留空则不修改)</p>
            </div>
            
            <div class="p-6">
                <div class="max-w-md">
                    <label class="block text-sm font-bold text-gray-700 mb-1">新密码</label>
                    <input type="password" name="new_password" id="newPass" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-black outline-none transition sm:text-sm" placeholder="••••••" oninput="checkStrength()">
                    
                    <!-- 强度条 -->
                    <div class="mt-2 flex items-center gap-2 opacity-50 transition-opacity" id="strengthWrapper">
                        <div class="flex-1 h-1.5 bg-gray-100 rounded-full overflow-hidden">
                            <div id="strengthBar" class="h-full w-0 bg-red-500 transition-all duration-300"></div>
                        </div>
                        <span id="strengthText" class="text-xs text-gray-400 font-medium w-10 text-right"></span>
                    </div>
                    <p id="strengthHint" class="text-xs text-red-500 mt-1 hidden">密码强度不足，无法保存。</p>
                </div>
            </div>
        </div>

        <!-- 底部按钮 -->
        <div class="flex justify-end pt-4">
            <button type="submit" id="saveBtn" class="bg-black text-white px-8 py-2.5 rounded-lg font-medium hover:bg-gray-800 transition shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
                保存所有设置
            </button>
        </div>
    </form>
</div>

<script>
    function checkStrength() {
        const val = document.getElementById('newPass').value;
        const wrapper = document.getElementById('strengthWrapper');
        const bar = document.getElementById('strengthBar');
        const text = document.getElementById('strengthText');
        const btn = document.getElementById('saveBtn');
        const hint = document.getElementById('strengthHint');

        if (!val) {
            // 为空时不修改，所以允许保存
            wrapper.classList.add('opacity-50');
            bar.style.width = '0%';
            text.innerText = '';
            btn.disabled = false;
            btn.classList.remove('opacity-50', 'cursor-not-allowed');
            hint.classList.add('hidden');
            return;
        }

        wrapper.classList.remove('opacity-50');
        
        let score = 0;
        if (val.length >= 8) score += 30;
        if (val.length >= 12) score += 20;
        if (/[A-Z]/.test(val)) score += 15;
        if (/[a-z]/.test(val)) score += 15;
        if (/[0-9]/.test(val)) score += 15;
        if (/[^A-Za-z0-9]/.test(val)) score += 20;

        if (score < 50) {
            bar.style.width = '30%'; bar.className = 'h-full bg-red-500'; text.innerText = '弱';
            text.className = 'text-xs text-red-500 w-10 text-right';
            btn.disabled = true;
            btn.classList.add('opacity-50', 'cursor-not-allowed');
            hint.classList.remove('hidden');
        } else if (score < 80) {
            bar.style.width = '60%'; bar.className = 'h-full bg-yellow-500'; text.innerText = '中';
            text.className = 'text-xs text-yellow-600 w-10 text-right';
            btn.disabled = false;
            btn.classList.remove('opacity-50', 'cursor-not-allowed');
            hint.classList.add('hidden');
        } else {
            bar.style.width = '100%'; bar.className = 'h-full bg-green-500'; text.innerText = '强';
            text.className = 'text-xs text-green-600 w-10 text-right';
            btn.disabled = false;
            btn.classList.remove('opacity-50', 'cursor-not-allowed');
            hint.classList.add('hidden');
        }
    }
</script>